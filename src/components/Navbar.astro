---
import { Battery, Search, ShoppingCart, Menu, X, ChevronDown } from 'lucide-react';
import CartDrawer from './CartDrawer';
import ProductSearch from './ProductSearch.astro';
---

<header class="sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur-sm">
  <div class="bg-primary w-full py-2">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between text-white">
        <div class="flex items-center gap-2">
          <Battery className="h-4 w-4 fill-white/20" />
          <span class="text-xs font-medium">Call Us: +91-234-567-890</span>
        </div>
        <div class="flex items-center gap-2">
          <span class="text-xs font-medium">Email: support@voltcore.com</span>
        </div>
      </div>
    </div>
  </div>

  <div class="container mx-auto flex h-16 items-center justify-between px-4">
    <div class="flex items-center gap-4 md:gap-8">
      <a href="/" class="flex items-center gap-2 font-bold tracking-tighter text-lg sm:text-xl">
        <Battery className="h-5 w-5 sm:h-6 sm:w-6 text-primary fill-primary/20" />
        <span>VOLT<span class="text-primary">CORE</span></span>
      </a>

      <nav class="hidden md:flex items-center gap-6 text-sm font-medium">
        <div class="group relative">
          <button class="flex items-center gap-1 hover:text-primary transition-colors py-6">
            <a href="/products">Products</a>
            <ChevronDown className="h-4 w-4 transition-transform group-hover:rotate-180" />
          </button>

          <div class="absolute left-0 top-full pt-0 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
            <div class="bg-card border border-border rounded-b-lg shadow-xl py-8 px-10 w-max min-w-[800px] flex gap-12">
              <div class="min-w-[200px]">
                <h3 class="text-xs font-bold tracking-wider text-foreground/70 uppercase mb-4">Automotive Batteries</h3>
                <ul class="space-y-3">
                  <li><a href="/products?application=two_wheeler" class="text-sm hover:text-primary transition-colors">Two Wheeler Batteries</a></li>
                  <li><a href="/products?application=four_wheeler" class="text-sm hover:text-primary transition-colors">Four Wheeler Batteries</a></li>
                  <li><a href="/products?application=commercial" class="text-sm hover:text-primary transition-colors">Commercial Vehicle Batteries</a></li>
                </ul>
              </div>

              <div class="min-w-[200px]">
                <h3 class="text-xs font-bold tracking-wider text-foreground/70 uppercase mb-4">Home & Backup</h3>
                <ul class="space-y-3">
                  <li><a href="/products?category=inverter" class="text-sm hover:text-primary transition-colors">Inverter Batteries</a></li>
                  <li><a href="/products?category=ups" class="text-sm hover:text-primary transition-colors">UPS Batteries</a></li>
                  <li><a href="/products?category=tubular" class="text-sm hover:text-primary transition-colors">Tubular Batteries</a></li>
                </ul>
              </div>

              <div class="min-w-[200px]">
                <h3 class="text-xs font-bold tracking-wider text-foreground/70 uppercase mb-4">Industrial & Energy</h3>
                <ul class="space-y-3">
                  <li><a href="/products?category=solar" class="text-sm hover:text-primary transition-colors">Solar Batteries</a></li>
                  <li><a href="/products?category=industrial" class="text-sm hover:text-primary transition-colors">Industrial Batteries</a></li>
                  <li><a href="/products?category=lithium" class="text-sm hover:text-primary transition-colors">Lithium-ion Batteries</a></li>
                </ul>
              </div>

              <div class="min-w-[180px] border-l border-border pl-10">
                <h3 class="text-xs font-bold tracking-wider text-foreground/70 uppercase mb-4">Browse by Brand</h3>
                <ul class="space-y-3">
                  <li><a href="/products?brand=amaron" class="text-sm hover:text-primary transition-colors">Amaron</a></li>
                  <li><a href="/products?brand=exide" class="text-sm hover:text-primary transition-colors">Exide</a></li>
                  <li><a href="/products?brand=luminous" class="text-sm hover:text-primary transition-colors">Luminous</a></li>
                  <li><a href="/products?brand=livguard" class="text-sm hover:text-primary transition-colors">Livguard</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <a href="/support" class="hover:text-primary transition-colors">Support</a>
        <a href="/about" class="hover:text-primary transition-colors">About</a>
      </nav>
    </div>

    <div class="flex items-center gap-2 sm:gap-4">
      <div class="hidden md:block w-[380px]">
        <ProductSearch />
      </div>
      
      <CartDrawer client:load />
      
      <button 
        id="mobile-menu-btn" 
        aria-expanded="false" 
        aria-controls="mobile-menu"
        class="md:hidden h-10 w-10 flex items-center justify-center hover:bg-accent rounded-md transition-colors"
      >
        <Menu id="menu-icon" className="h-6 w-6 block" />
        <X id="close-icon" className="h-6 w-6 hidden" />
      </button>
    </div>
  </div>

  <div 
    id="mobile-menu" 
    class="md:hidden fixed inset-0 top-full bg-background z-40 transition-transform duration-300 ease-in-out translate-x-full border-t border-border h-[calc(100vh-100%)]"
  >
    <div class="h-full overflow-y-auto bg-background pb-20">
      <nav class="container mx-auto px-4 py-6 space-y-4">

          <div class="px-4 pt-4 pb-3 border-b border-border">
            <ProductSearch />
          </div>
        <details class="group border-b border-border pb-4">
          
          <summary class="list-none flex items-center justify-between py-3 px-2 hover:bg-accent rounded-md cursor-pointer">
            <span class="text-sm font-semibold text-foreground">Products</span>
            <ChevronDown className="h-5 w-5 transition-transform group-open:rotate-180" />
          </summary>
          
          <div class="mt-4 pl-4 space-y-8">
            <div>
              <h3 class="text-[10px] font-bold tracking-wider text-foreground/50 uppercase mb-3">Automotive Batteries</h3>
              <ul class="space-y-3 border-l border-primary/20 pl-4">
                <li><a href="/products?application=two_wheeler" class="text-sm block">Two Wheeler</a></li>
                <li><a href="/products?application=four_wheeler" class="text-sm block">Four Wheeler</a></li>
                <li><a href="/products?application=commercial" class="text-sm block">Commercial</a></li>
              </ul>
            </div>

            <div>
              <h3 class="text-[10px] font-bold tracking-wider text-foreground/50 uppercase mb-3">Home & Backup</h3>
              <ul class="space-y-3 border-l border-primary/20 pl-4">
                <li><a href="/products?category=inverter" class="text-sm block">Inverter Batteries</a></li>
                <li><a href="/products?category=ups" class="text-sm block">UPS Batteries</a></li>
              </ul>
            </div>

            <div>
              <h3 class="text-[10px] font-bold tracking-wider text-foreground/50 uppercase mb-3">Industrial & Energy</h3>
              <ul class="space-y-3 border-l border-primary/20 pl-4">
                <li><a href="/products?category=solar" class="text-sm block">Solar</a></li>
                <li><a href="/products?category=industrial" class="text-sm block">Industrial</a></li>
                <li><a href="/products?category=lithium" class="text-sm block">Lithium-ion</a></li>
              </ul>
            </div>

            <div>
              <h3 class="text-[10px] font-bold tracking-wider text-foreground/50 uppercase mb-3">Browse by Brand</h3>
              <div class="grid grid-cols-2 gap-2 border-l border-primary/20 pl-4">
                <a href="/brand/amaron" class="text-sm py-1">Amaron</a>
                <a href="/brand/exide" class="text-sm py-1">Exide</a>
                <a href="/brand/luminous" class="text-sm py-1">Luminous</a>
                <a href="/brand/livguard" class="text-sm py-1">Livguard</a>
              </div>
            </div>
          </div>
        </details>

        <a href="/support" class="block py-3 px-2 text-sm font-semibold hover:bg-accent rounded-md">Support</a>
        <a href="/about" class="block py-3 px-2 text-sm font-semibold hover:bg-accent rounded-md">About</a>
      </nav>
    </div>
  </div>

</header>

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('mobile-menu-btn');
    const menu = document.getElementById('mobile-menu');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');
    const body = document.body;

    if (btn && menu) {
      btn.addEventListener('click', () => {
        const isOpen = menu.classList.contains('translate-x-0');
        
        menu.classList.toggle('translate-x-full', isOpen);
        menu.classList.toggle('translate-x-0', !isOpen);
        
        menuIcon.classList.toggle('hidden', !isOpen);
        closeIcon.classList.toggle('hidden', isOpen);

        btn.setAttribute('aria-expanded', !isOpen);
        body.style.overflow = !isOpen ? 'hidden' : '';
      });

      const links = menu.querySelectorAll('a');
      links.forEach(link => {
        link.addEventListener('click', () => {
          menu.classList.add('translate-x-full');
          menu.classList.remove('translate-x-0');
          menuIcon.classList.remove('hidden');
          closeIcon.classList.add('hidden');
          body.style.overflow = '';
        });
      });
    }
  });



</script>